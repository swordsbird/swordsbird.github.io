<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
    <head>
        <title>Tsinghua University Hyperbolic tree</title>
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>

        <link rel="icon"       href="img/avatar-light.png"/>
        <link rel="stylesheet" href="hypertree-of-life-light.css" id="ldswitch">

        <!--
        <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
        -->
        
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-124333733-1"></script>        
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'UA-124333733-1');
        </script>        
        

        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:site" content="@GlatzhoferM">
        <meta name="twitter:creator" content="@GlatzhoferM">
        <meta property="og:title" content="Hyperbolic Tree of Tsinghua" />
        <meta property="og:description" content="An Interactive Evolutionary Tree Visualisation" />
        <meta property="og:image" content="https://hyperbolic-tree-of-life.github.io/img/preview.png" />    
      
    </head>

    <body>    
        <style>
            .unitdisk-nav svg, .unitdisk-nav svg .mouse-circle-cursor {
                cursor: pointer;
            }
        </style>
        <script>
            const ua = navigator.userAgent
            const isMobile = window.matchMedia("only screen and (max-width: 760px)").matches
            const isValidBrowser = !/MSIE/i.test(ua) && !/Trident/i.test(ua) && !/Edge\/\d./i.test(ua)
            console.log(ua, isMobile, isValidBrowser)

            if (false)// isMobile || !isValidBrowser)
                document.body.innerHTML = '<p style="text-align:center; color:#fff;"><br><br>Sorry, your browser/device is not supported yet ğŸ˜¿ <br>Please use Chrome, Firefox or Safari,<br>on a device at least the size of a tablet.'
            else {                
                const script = document.createElement('script')
                script.src = 'hypertree-of-life.js'
                document.head.appendChild(script)
                document.body.onload = function() {
                    initMainPage()
                }                
            }

            const app = {
                text: null,
                hypertree: null
            }
            function initMainPage() {
                const language = window.navigator.userLanguage || window.navigator.language
                const l = language.split('-')[0]
                console.log(l)

                this.controllerTree = new htol.Navigation2(
                    { parent: document.body }, 
                    { 
                        title: "Hyperbolic Tree of Life",
                        language: l,
                        languages: ['en'],
                        onLangChange:  l=> {
                            console.log("lang change", l)                        
                            app.text.innerHTML = html.hasOwnProperty(l) ? html[l] : html['en']

                            const nl = htol.loaders.fromLangFile(`langmaps/${l}.lang.json`)
                            app.hypertree.api.setLangloader(()=> {
                                app.hypertree.unitdisk.layerStack.updateLayers()
                                app.hypertree.update.data()
                            }, ()=>{}, nl)  
                        }, 
                        content: p=> {
                            var d = document.createElement('div')                   
                            console.log(html.hasOwnProperty(l) ? html[l] : html['en'])                            
                            d.innerHTML = `
                                <div id='info'>               
                                    <div class="topic">Hyperbolic Tree of Life</div>
                                    <div id="text"></div>
                                </div>
                                <div id="maintree"></div>
                                <div class="footer">
                                    <svg viewBox='0 0 300 1' preserveAspectRatio='none'>
                                        <path d='M0,0 300,0' />
                                    </svg>
                                </div>`
                            p.appendChild(d)
                            app.text = d.querySelector('#text')                            
                            app.text.innerHTML = html.hasOwnProperty(l) ? html[l] : html['en']
                            

                            const Ï€ = Math.PI
                            const iconmap = new htol.Icons()
                            const hasLazy =          n=> (n.hasOutChildren && n.isOutÎ»)
                            const isLeaf =           n=> !n.children || !n.children.length
                            const isRoot =           n=> !n.parent 
                            const hasCircle =        n=> hasLazy(n) || isRoot(n) || isLeaf(n)
                            const nodeInitR =        (c)=> (ud, d)=> c * ((d.children && d.parent) ? innerNodeScale(d) : 1)     
                            const nodeInitRNoInner = (c)=> (ud, d)=> c
                            const nodeScale =        d=> d.distScale * (hasLazy(d) ? .8 : 1)    
                            const nodeScaleNoInner = d=> d.distScale    
                            const innerNodeScale =   d=> d.precalc.weightScale
                            
                            const otolSetModel = new htol.OtolSetModel()

                            app.hypertree = new htol.Hypertree(
                                { parent:document.querySelector('#maintree') }, 
                                {
                                    dataloader: htol.loaders.fromFile(`hierarchies/tsinghua_tree.json`),
                                    langloader: htol.loaders.fromLangFile(`langmaps/${l}.lang.json`),
                                    langInitBFS: (ht, n)=> {
                                        n.precalc.label = `${n.data.name}`
                                    }
                                }
                            )                            
                            app.hypertree.initPromise
                                .then(()=> new Promise((ok, err)=> app.hypertree.animateUp(ok, err)))
                                .then(()=> app.hypertree.drawDetailFrame())
                        }
                    }            
                )
            }
/*
        
*/

/*
        Das Open tree of Life project 

        Hyperbolic Browsing ist eine interactive visualisierungs technik zur 
        darstellung von gerichteten azyklischen Graphen kurz DAG. 
        Pylogenetische BÃ¤ume wie der des Open Tree of Life Projekts sind DAGs.

        Hyperbolic Tree of life zeig die als 2m species der otol baums 
        in 
*/
        const html = {
            en: `       è¿™æ˜¯æ¸…åå¤§å­¦é™¢ç³»ç»“æ„çš„äº¤äº’å¼å¯è§†åŒ–å±•ç¤ºï¼Œ
                        å±•ç°äº†ä¸åŒå­¦é™¢ã€ç³»æ‰€å’Œç ”ç©¶ä¸­å¿ƒä¹‹é—´çš„ç»„ç»‡å…³ç³»ã€‚<sup>æ¸…åå¤§å­¦</sup>
                        <br><br>
                        <a href="https://www.tsinghua.edu.cn">æ¸…åå¤§å­¦</a>
                        æ˜¯ä¸­å›½æœ€è‘—åçš„é«˜ç­‰å­¦åºœä¹‹ä¸€ï¼Œæ‹¥æœ‰å®Œæ•´çš„é™¢ç³»å’Œç ”ç©¶æœºæ„ä½“ç³»ã€‚
                        æœ¬å¯è§†åŒ–ç³»ç»Ÿå±•ç¤ºäº†åŒ…æ‹¬20ä¸ªå­¦é™¢ã€42ä¸ªç³»ã€30å¤šä¸ªç ”ç©¶é™¢ï¼ˆæ‰€ã€ä¸­å¿ƒï¼‰çš„ç»„ç»‡ç»“æ„ã€‚
                        <br><br>
                        è¿™ä¸ªåŒæ›²æ ‘æµè§ˆå™¨æä¾›äº†ä¸€ä¸ªäº¤äº’å¼çš„"æ ‘çŠ¶"å¯è§†åŒ–ç•Œé¢ï¼Œ
                        è®©æ‚¨å¯ä»¥æ¢ç´¢æ¸…åå¤§å­¦çš„ç»„ç»‡å±‚çº§ç»“æ„ã€‚
                        æ‚¨å¯ä»¥é€šè¿‡æ‹–æ‹½æ¥å¹³ç§»è§†å›¾ï¼Œä½¿ç”¨æåˆæ‰‹åŠ¿æˆ–é¼ æ ‡æ»šè½®æ¥æ”¾å¤§ç¼©å°ä¸åŒåŒºåŸŸã€‚
                        <br><br>
                        æœ¬ç³»ç»Ÿå®Œæ•´å±•ç¤ºäº†å­¦æ ¡çš„ç»„ç»‡æ¶æ„ï¼ŒåŒ…æ‹¬å„ä¸ªå­¦é™¢ã€ç³»æ‰€ã€ç ”ç©¶ä¸­å¿ƒä»¥åŠé¢†å¯¼èŒåŠ¡ã€‚
                        <br><br>
                        æœ¬å¯è§†åŒ–å·¥å…·åŸºäºå¼€æºçš„
                        <a href="https://github.com/glouwa/d3-hypertree/">d3-hypertree</a>
                        åŒæ›²æ ‘æµè§ˆå™¨å¼€å‘ã€‚
                `
        }
        /*
        what is it (pose with # of nodes), how to interact, data from otol, upload own file, 

        what is it, dev link, history slides, feature slides, developer demos.
        examples for: web1, web2, python, R, observable.

        2 
        9 5
        2
        */
        </script>                
    </body>
</html>



