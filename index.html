<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
    <head>
        <title>Tsinghua University Hyperbolic tree</title>
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>

        <link rel="icon"       href="img/avatar-light.png"/>
        <link rel="stylesheet" href="hypertree-of-life-light.css" id="ldswitch">

        <!--
        <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
        -->
        
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-124333733-1"></script>        
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'UA-124333733-1');
        </script>        
        

        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:site" content="@GlatzhoferM">
        <meta name="twitter:creator" content="@GlatzhoferM">
        <meta property="og:title" content="Hyperbolic Tree of Tsinghua" />
        <meta property="og:description" content="An Interactive Evolutionary Tree Visualisation" />
        <meta property="og:image" content="https://hyperbolic-tree-of-life.github.io/img/preview.png" />    
      
    </head>

    <body>    
        <style>
            .unitdisk-nav svg, .unitdisk-nav svg .mouse-circle-cursor {
                cursor: pointer;
            }
        </style>
        <script>
            const ua = navigator.userAgent
            const isMobile = window.matchMedia("only screen and (max-width: 760px)").matches
            const isValidBrowser = !/MSIE/i.test(ua) && !/Trident/i.test(ua) && !/Edge\/\d./i.test(ua)
            console.log(ua, isMobile, isValidBrowser)

            if (false)// isMobile || !isValidBrowser)
                document.body.innerHTML = '<p style="text-align:center; color:#fff;"><br><br>Sorry, your browser/device is not supported yet 😿 <br>Please use Chrome, Firefox or Safari,<br>on a device at least the size of a tablet.'
            else {                
                const script = document.createElement('script')
                script.src = 'hypertree-of-life.js'
                document.head.appendChild(script)
                document.body.onload = function() {
                    initMainPage()
                }                
            }

            const app = {
                text: null,
                hypertree: null
            }
            function initMainPage() {
                const language = window.navigator.userLanguage || window.navigator.language
                const l = language.split('-')[0]
                console.log(l)

                this.controllerTree = new htol.Navigation2(
                    { parent: document.body }, 
                    { 
                        title: "Hyperbolic Tree of Life",
                        language: l,
                        languages: ['en'],
                        onLangChange:  l=> {
                            console.log("lang change", l)                        
                            app.text.innerHTML = html.hasOwnProperty(l) ? html[l] : html['en']

                            const nl = htol.loaders.fromLangFile(`langmaps/${l}.lang.json`)
                            app.hypertree.api.setLangloader(()=> {
                                app.hypertree.unitdisk.layerStack.updateLayers()
                                app.hypertree.update.data()
                            }, ()=>{}, nl)  
                        }, 
                        content: p=> {
                            var d = document.createElement('div')                   
                            console.log(html.hasOwnProperty(l) ? html[l] : html['en'])                            
                            d.innerHTML = `
                                <div id='info'>               
                                    <div class="topic">Hyperbolic Tree of Life</div>
                                    <div id="text"></div>
                                </div>
                                <div id="maintree"></div>
                                <div class="footer">
                                    <svg viewBox='0 0 300 1' preserveAspectRatio='none'>
                                        <path d='M0,0 300,0' />
                                    </svg>
                                </div>`
                            p.appendChild(d)
                            app.text = d.querySelector('#text')                            
                            app.text.innerHTML = html.hasOwnProperty(l) ? html[l] : html['en']
                            

                            const π = Math.PI
                            const iconmap = new htol.Icons()
                            const hasLazy =          n=> (n.hasOutChildren && n.isOutλ)
                            const isLeaf =           n=> !n.children || !n.children.length
                            const isRoot =           n=> !n.parent 
                            const hasCircle =        n=> hasLazy(n) || isRoot(n) || isLeaf(n)
                            const nodeInitR =        (c)=> (ud, d)=> c * ((d.children && d.parent) ? innerNodeScale(d) : 1)     
                            const nodeInitRNoInner = (c)=> (ud, d)=> c
                            const nodeScale =        d=> d.distScale * (hasLazy(d) ? .8 : 1)    
                            const nodeScaleNoInner = d=> d.distScale    
                            const innerNodeScale =   d=> d.precalc.weightScale
                            
                            const otolSetModel = new htol.OtolSetModel()

                            app.hypertree = new htol.Hypertree(
                                { parent:document.querySelector('#maintree') }, 
                                {
                                    dataloader: htol.loaders.fromFile(`hierarchies/tsinghua_tree.json`),
                                    langloader: htol.loaders.fromLangFile(`langmaps/${l}.lang.json`),
                                    langInitBFS: (ht, n)=> {
                                        n.precalc.label = `${n.data.name}`
                                    }
                                }
                            )                            
                            app.hypertree.initPromise
                                .then(()=> new Promise((ok, err)=> app.hypertree.animateUp(ok, err)))
                                .then(()=> app.hypertree.drawDetailFrame())
                        }
                    }            
                )
            }
/*
        
*/

/*
        Das Open tree of Life project 

        Hyperbolic Browsing ist eine interactive visualisierungs technik zur 
        darstellung von gerichteten azyklischen Graphen kurz DAG. 
        Pylogenetische Bäume wie der des Open Tree of Life Projekts sind DAGs.

        Hyperbolic Tree of life zeig die als 2m species der otol baums 
        in 
*/
        const html = {
            en: `       这是清华大学院系结构的交互式可视化展示，
                        展现了不同学院、系所和研究中心之间的组织关系。<sup>清华大学</sup>
                        <br><br>
                        <a href="https://www.tsinghua.edu.cn">清华大学</a>
                        是中国最著名的高等学府之一，拥有完整的院系和研究机构体系。
                        本可视化系统展示了包括20个学院、42个系、30多个研究院（所、中心）的组织结构。
                        <br><br>
                        这个双曲树浏览器提供了一个交互式的"树状"可视化界面，
                        让您可以探索清华大学的组织层级结构。
                        您可以通过拖拽来平移视图，使用捏合手势或鼠标滚轮来放大缩小不同区域。
                        <br><br>
                        本系统完整展示了学校的组织架构，包括各个学院、系所、研究中心以及领导职务。
                        <br><br>
                        本可视化工具基于开源的
                        <a href="https://github.com/glouwa/d3-hypertree/">d3-hypertree</a>
                        双曲树浏览器开发。
                `
        }
        /*
        what is it (pose with # of nodes), how to interact, data from otol, upload own file, 

        what is it, dev link, history slides, feature slides, developer demos.
        examples for: web1, web2, python, R, observable.

        2 
        9 5
        2
        */
        </script>                
    </body>
</html>



